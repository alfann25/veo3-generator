<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Prompt Veo 3</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- React, ReactDOM, and Babel CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans">
    <div id="root"></div>

    <script type="text/babel">
        function App() {
          // State untuk setiap komponen prompt
          const [subjek, setSubjek] = React.useState('');
          const [aksi, setAksi] = React.useState('');
          const [ekspresi, setEkspresi] = React.useState('');
          const [tempat, setTempat] = React.useState('');
          const [waktu, setWaktu] = React.useState('');
          const [sudutKamera, setSudutKamera] = React.useState('');
          const [gerakanKamera, setGerakanKamera] = React.useState('');
          const [pencahayaan, setPencahayaan] = React.useState('');
          const [gayaVideo, setGayaVideo] = React.useState('');
          const [aspekRasio, setAspekRasio] = React.useState('');
          const [suasanaVideo, setSuasanaVideo] = React.useState('');
          const [backsound, setBacksound] = React.useState('');
          const [bahasaAktor, setBahasaAktor] = React.useState('');
          const [teksDialogAktor, setTeksDialogAktor] = React.useState('');
          const [durasiVideo, setDurasiVideo] = React.useState('');
          const [fps, setFps] = React.useState('');
          const [detailTambahan, setDetailTambahan] = React.useState('');
          const [generatedPrompt, setGeneratedPrompt] = React.useState('');
          const [showCopyMessage, setShowCopyMessage] = React.useState(false);

          // State untuk bahasa output prompt
          const [bahasaOutputPrompt, setBahasaOutputPrompt] = React.useState('Indonesia');

          // State untuk unggah gambar dan analisis
          const [imageFile, setImageFile] = React.useState(null);
          const [imageUrl, setImageUrl] = React.useState('');
          const [promptDariGambar, setPromptDariGambar] = React.useState('');
          const [isAnalyzingImage, setIsAnalyzingImage] = React.useState(false);
          const [showImagePromptCopyMessage, setShowImagePromptCopyMessage] = React.useState(false);
          const [imageError, setImageError] = React.useState('');

          // State untuk Penyempurna Prompt Otomatis
          const [enhancedPrompt, setEnhancedPrompt] = React.useState('');
          const [isEnhancingPrompt, setIsEnhancingPrompt] = React.useState(false);
          const [showEnhancedPromptCopyMessage, setShowEnhancedPromptCopyMessage] = React.useState(false);
          const [enhanceError, setEnhanceError] = React.useState('');

          // State untuk Evolusi Prompt
          const [evolvedPrompts, setEvolvedPrompts] = React.useState([]);
          const [isEvolvingPrompt, setIsEvolvingPrompt] = React.useState(false);
          const [evolveError, setEvolveError] = React.useState('');
          const [showEvolvedPromptCopyMessage, setShowEvolvedPromptCopyMessage] = React.useState(false);


          // State untuk Riwayat Prompt
          const [promptHistory, setPromptHistory] = React.useState([]);
          // State untuk Prompt Favorit
          const [favoritePrompts, setFavoritePrompts] = React.useState([]);

          // State untuk Manajemen Multi-Adegan
          const [scenes, setScenes] = React.useState([]);
          const [currentSceneIndex, setCurrentSceneIndex] = React.useState(null);

          // State untuk Mode Malam/Siang
          const [isDarkMode, setIsDarkMode] = React.useState(true);

          // State untuk Prompt Mixer
          const [selectedPromptsForMixer, setSelectedPromptsForMixer] = React.useState([]);
          const [mixedPrompt, setMixedPrompt] = React.useState('');
          const [isMixingPrompts, setIsMixingPrompts] = React.useState(false);
          const [mixError, setMixError] = React.useState('');

          // Opsi Dropdown
          const pilihanWaktu = [
            { label: 'Pilih Waktu (Opsional)', value: '' },
            { label: 'Pagi Hari', value: 'pagi hari' },
            { label: 'Siang Hari', value: 'siang hari' },
            { label: 'Sore Hari', value: 'sore hari' },
            { label: 'Senja', value: 'senja' },
            { label: 'Malam Hari', value: 'malam hari' },
            { label: 'Fajar', value: 'fajar' },
          ];

          const pilihanSudutKamera = [
            { label: 'Pilih Sudut Kamera (Opsional)', value: '' },
            { label: 'Wide Shot (Jarak Jauh)', value: 'wide shot (jarak jauh)' },
            { label: 'Close-up (Jarak Dekat)', value: 'close-up (jarak dekat)' },
            { label: 'Medium Shot (Setengah Badan)', value: 'medium shot (setengah badan)' },
            { label: 'Long Shot (Sangat Jauh)', value: 'long shot (sangat jauh)' },
            { label: 'Dutch Angle (Miring)', value: 'dutch angle (miring)' },
            { label: "Bird's Eye View (Dari Atas)", value: "bird's eye view (dari atas)" },
            { label: 'Low Angle (Dari Bawah)', value: 'low angle (dari bawah)' },
          ];

          const pilihanGerakanKamera = [
            { label: 'Pilih Gerakan Kamera (Opsional)', value: '' },
            { label: 'Statik (Diam)', value: 'statik (diam)' },
            { label: 'Pan (Geser Horizontal)', value: 'pan (geser horizontal)' },
            { label: 'Tilt (Dongak/Tunduk Vertikal)', value: 'tilt (dongak/tunduk vertikal)' },
            { label: 'Zoom In (Perbesar)', value: 'zoom in (perbesar)' },
            { label: 'Zoom Out (Perkecil)', value: 'zoom out (perkecil)' },
            { label: 'Tracking Shot (Mengikuti Subjek)', value: 'tracking shot (mengikuti subjek)' },
            { label: 'Dolly Shot (Maju/Mundur)', value: 'dolly shot (maju/mundur)' },
            { label: 'Crane Shot (Gerakan Atas/Bawah)', value: 'crane shot (gerakan atas/bawah)' },
          ];

          const pilihanPencahayaan = [
            { label: 'Pilih Pencahayaan (Opsional)', value: '' },
            { label: 'Cahaya Alami', value: 'cahaya alami' },
            { label: 'Cahaya Dramatis', value: 'cahaya dramatis' },
            { label: 'Cahaya Lembut', value: 'cahaya lembut' },
            { label: 'Cahaya Kontras', value: 'cahaya kontras' },
            { label: 'Cahaya Neon', value: 'cahaya neon' },
            { label: 'Cahaya Pesta', value: 'cahaya pesta' },
            { label: 'Golden Hour (Cahaya Keemasan)', value: 'golden hour (cahaya keemasan)' },
          ];

          const pilihanGayaVideo = [
            { label: 'Pilih Gaya Video (Opsional)', value: '' },
            { label: 'Realistis (Fotografi)', value: 'realistis (fotografi)' },
            { label: 'Animasi Kartun 2D', value: 'animasi kartun 2D' },
            { label: 'Animasi 3D', value: 'animasi 3D' },
            { label: 'Gaya Sinematik (Film)', value: 'gaya sinematik (film)' },
            { label: 'Gaya Dokumen', value: 'gaya dokumen' },
            { label: 'Seni Digital', value: 'seni digital' },
            { label: 'Surealis', value: 'surealis' },
            { label: 'Gaya Anime', value: 'gaya anime' },
            { label: 'Gaya Lukisan Air', value: 'gaya lukisan air' },
            { label: 'Pixel Art', value: 'pixel art' },
          ];

          const pilihanAspekRasio = [
            { label: 'Pilih Aspek Rasio (Opsional)', value: '' },
            { label: '16:9 (Layar Lebar)', value: '16:9' },
            { label: '9:16 (Vertikal/Story)', value: '9:16' },
            { label: '4:3 (Klasik)', value: '4:3' },
            { label: '1:1 (Persegi)', value: '1:1' },
          ];

          const pilihanSuasanaVideo = [
            { label: 'Pilih Suasana Video (Opsional)', value: '' },
            { label: 'Bahagia', value: 'bahagia' },
            { label: 'Sedih', value: 'sedih' },
            { label: 'Misterius', value: 'misterius' },
            { label: 'Menenangkan', value: 'menenangkan' },
            { label: 'Ceria', value: 'ceria' },
            { label: 'Tegang', value: 'tegang' },
            { label: 'Epik', value: 'epik' },
            { label: 'Romantis', value: 'romantis' },
            { label: 'Horor', value: 'horor' },
            { label: 'Humor', value: 'humor' },
          ];

          const pilihanBahasaAktor = [
            { label: 'Pilih Bahasa (Opsional)', value: '' },
            { label: 'Inggris', value: 'Inggris' },
            { label: 'Indonesia', value: 'Indonesia' },
            { label: 'Jawa', value: 'Jawa' },
            { label: 'Spanyol', value: 'Spanyol' },
            { label: 'Prancis', value: 'Prancis' },
            { label: 'Jerman', value: 'Jerman' },
            { label: 'Jepang', value: 'Jepang' },
            { label: 'Mandarin', value: 'Mandarin' },
            { label: 'Hindi', value: 'Hindi' },
            { label: 'Arab', value: 'Arab' },
          ];

          const pilihanBahasaOutputPrompt = [
            { label: 'Indonesia', value: 'Indonesia' },
            { label: 'English', value: 'English' },
            { label: 'Jawa', value: 'Jawa' },
            { label: 'Spanish', value: 'Spanish' },
            { label: 'French', value: 'French' },
            { label: 'German', value: 'German' },
            { label: 'Japanese', value: 'Japanese' },
            { label: 'Mandarin', value: 'Mandarin' },
            { label: 'Hindi', value: 'Hindi' },
            { label: 'Arabic', value: 'Arabic' },
          ];

          // Data acak untuk generator prompt acak
          const randomSubjects = ['Seorang astronot', 'Seekor kucing lucu', 'Robot pembersih', 'Penyihir muda', 'Seorang musisi jalanan', 'Penjelajah hutan', 'Seniman jalanan', 'Detektif swasta'];
          const randomActions = ['menari dengan gembira', 'terbang di atas kota', 'membuat ramuan misterius', 'bermain gitar dengan semangat', 'berburu makanan', 'memecahkan teka-teki kuno', 'melukis mural besar', 'melarikan diri dari kejaran'];
          const randomExpressions = ['bahagia', 'penasaran', 'bingung', 'tekun', 'sedih', 'terkejut', 'marah', 'santai'];
          const randomDetails = ['cahaya neon di sekitarnya', 'kupu-kupu bercahaya', 'awan berbentuk unik', 'bangunan tinggi berkilauan', 'tanaman eksotis', 'mesin uap yang berputar', 'ukiran kuno di dinding', 'hewan peliharaan yang setia'];
          const randomBacksounds = ['musik elektronik futuristik', 'suara alam menenangkan', 'musik orkestra epik', 'musik jazz lembut', 'melodi pop ceria', 'suara hujan rintik', 'ketukan drum tribal', 'gema langkah kaki'];
          const randomDialogs = ['"Selamat pagi, dunia!"', '"Aku menemukan sesuatu yang menakjubkan."', '"Ini tidak akan mudah."', '"Mari kita coba lagi!"', '"Apakah kamu melihat itu?"', '"Kita harus segera pergi!"', '"Cerita ini baru saja dimulai."', '"Jangan menyerah!"'];

          // Pustaka Template Prompt
          const promptTemplates = [
            {
              label: 'Pilih Template (Opsional)',
              value: '',
              data: {}
            },
            {
              label: 'Film Horor Klasik',
              value: 'horor_klasik',
              data: {
                tempat: 'Rumah tua berhantu di hutan lebat',
                waktu: 'Malam hari',
                subjek: 'Sosok bayangan bergerak perlahan di koridor',
                aksi: 'Menyelidiki suara aneh dari lantai atas',
                ekspresi: 'Ketakutan, cemas',
                gayaVideo: 'Gaya Sinematik (Film)',
                sudutKamera: 'Low Angle (Dari Bawah)',
                gerakanKamera: 'Dolly Shot (Maju/Mundur)',
                pencahayaan: 'Cahaya Dramatis',
                suasanaVideo: 'Horor, tegang',
                aspekRasio: '16:9',
                backsound: 'Musik string menyeramkan, suara rintihan',
                teksDialogAktor: 'Apa itu tadi?',
                durasiVideo: '15',
                fps: '24',
                detailTambahan: 'Lantai berderit, bayangan panjang, jendela pecah'
              }
            },
            {
              label: 'Animasi Petualangan Anak',
              value: 'animasi_anak',
              data: {
                tempat: 'Hutan berwarna-warni penuh jamur raksasa',
                waktu: 'Siang Hari',
                subjek: 'Anak laki-laki dan gadis kecil dengan hewan peliharaan lucu',
                aksi: 'Menjelajahi sungai menggunakan daun raksasa sebagai perahu',
                ekspresi: 'Ceria, antusias',
                gayaVideo: 'Animasi Kartun 2D',
                sudutKamera: 'Medium Shot (Setengah Badan)',
                gerakanKamera: 'Tracking Shot (Mengikuti Subjek)',
                pencahayaan: 'Cahaya Alami, terang',
                suasanaVideo: 'Ceria, bahagia',
                aspekRasio: '16:9',
                backsound: 'Musik ceria dan petualangan, suara kicauan burung',
                teksDialogAktor: 'Lihat, ada katak berbicara!',
                durasiVideo: '20',
                fps: '30',
                detailTambahan: 'Bunga bersinar, kupu-kupu besar, air sungai berkilauan'
              }
            },
            {
              label: 'Video Dokumenter Alam',
              value: 'dokumenter_alam',
              data: {
                tempat: 'Pegunungan bersalju dan gletser',
                waktu: 'Pagi Hari',
                subjek: 'Elang botak terbang tinggi mencari mangsa',
                aksi: 'Terbang melingkar di atas lembah, lalu menukik tajam',
                ekspresi: 'Tidak ada ekspresi',
                gayaVideo: 'Realistis (Fotografi)',
                sudutKamera: "Bird's Eye View (Dari Atas)",
                gerakanKamera: 'Crane Shot (Gerakan Atas/Bawah)',
                pencahayaan: 'Cahaya Alami, dingin',
                suasanaVideo: 'Menenangkan, epik',
                aspekRasio: '16:9',
                backsound: 'Suara angin, suara elang, musik orkestra megah',
                teksDialogAktor: 'Tidak ada dialog yang jelas terlihat.',
                durasiVideo: '30',
                fps: '24',
                detailTambahan: 'Puncak gunung tertutup salju, awan rendah, sungai es'
              }
            },
            {
              label: 'Adegan Fiksi Ilmiah Penuh Aksi',
              value: 'sci_fi_action',
              data: {
                tempat: 'Jalanan kota futuristik yang basah setelah hujan, dipenuhi neon',
                waktu: 'Malam hari',
                subjek: 'Seorang prajurit siber wanita dengan baju zirah bercahaya dan senjata plasma',
                aksi: 'Melompat di antara gedung pencakar langit, menembak drone musuh yang mengejar',
                ekspresi: 'Fokus, tegang',
                gayaVideo: 'Gaya Sinematik (Film)',
                sudutKamera: 'Dutch Angle (Miring)',
                gerakanKamera: 'Tracking Shot (Mengikuti Subjek)',
                pencahayaan: 'Cahaya Neon, dramatis, bayangan tajam',
                suasanaVideo: 'Tegang, epik',
                aspekRasio: '21:9',
                backsound: 'Musik cyberpunk dengan beat berat, suara tembakan laser',
                teksDialogAktor: 'Mereka tidak akan lolos kali ini!',
                durasiVideo: '25',
                fps: '30',
                detailTambahan: 'Hujan rintik, mobil terbang, iklan holografik berkedip, asap tebal'
              }
            },
            {
              label: 'Komedi Romantis di Kafe',
              value: 'romcom_cafe',
              data: {
                tempat: 'Kafe yang nyaman dengan jendela besar dan dekorasi vintage',
                waktu: 'Sore Hari',
                subjek: 'Dua orang muda, satu canggung dan satu ceria, duduk berhadapan',
                aksi: 'Saling bertukar pandang canggung, lalu tertawa karena lelucon',
                ekspresi: 'Canggung, malu, lalu bahagia',
                gayaVideo: 'Realistis (Fotografi)',
                sudutKamera: 'Medium Shot (Setengah Badan)',
                gerakanKamera: 'Statik (Diam)',
                pencahayaan: 'Cahaya Alami, lembut, hangat',
                suasanaVideo: 'Romantis, humor',
                aspekRasio: '16:9',
                backsound: 'Musik jazz lembut, suara bising kafe',
                teksDialogAktor: 'Apakah ini... takdir?',
                durasiVideo: '12',
                fps: '24',
                detailTambahan: 'Cangkir kopi berasap, buku terbuka di meja, lukisan di dinding'
              }
            },
            {
              label: 'Drama Sejarah Kolosal',
              value: 'historical_drama',
              data: {
                tempat: 'Medan perang kuno yang luas dengan bendera berkibar dan kuda',
                waktu: 'Siang Hari',
                subjek: 'Jenderal tua berjanggut memimpin pasukannya, menunggang kuda lapis baja',
                aksi: 'Memberikan pidato yang membakar semangat di hadapan ribuan tentara',
                ekspresi: 'Tegas, heroik, inspiratif',
                gayaVideo: 'Gaya Sinematik (Film)',
                sudutKamera: 'Long Shot (Sangat Jauh)',
                gerakanKamera: 'Crane Shot (Gerakan Atas/Bawah)',
                pencahayaan: 'Cahaya Alami, cerah, bayangan keras',
                suasanaVideo: 'Epik, tegang, heroik',
                aspekRasio: '2.35:1',
                backsound: 'Musik orkestra kolosal, suara teriakan perang, derap kuda',
                teksDialogAktor: 'Untuk kebebasan!',
                durasiVideo: '40',
                fps: '24',
                detailTambahan: 'Armor berkilauan, debu beterbangan, pedang terhunus, langit berawan'
              }
            },
            {
              label: 'Video Resep Memasak Estetik',
              value: 'cooking_aesthetic',
              data: {
                tempat: 'Dapur modern yang bersih dengan banyak cahaya alami',
                waktu: 'Siang Hari',
                subjek: 'Tangan koki profesional sedang menyiapkan hidangan gourmet',
                aksi: 'Mengiris sayuran dengan presisi, menumis bahan di wajan panas, menyajikan dengan indah',
                ekspresi: 'Fokus, presisi',
                gayaVideo: 'Realistis (Fotografi)',
                sudutKamera: 'Close-up (Jarak Dekat)',
                gerakanKamera: 'Statik (Diam)',
                pencahayaan: 'Cahaya Alami, lembut, merata',
                suasanaVideo: 'Menenangkan, elegan',
                aspekRasio: '16:9',
                backsound: 'Musik lo-fi lembut, suara mengiris, suara mendesis masakan',
                teksDialogAktor: 'Tidak ada dialog yang jelas terlihat.',
                durasiVideo: '60',
                fps: '30',
                detailTambahan: 'Bahan-bahan segar tertata rapi, peralatan dapur mengkilap, uap mengepul'
              }
            },
            {
              label: 'Iklan Produk Teknologi Modern',
              value: 'ad_tech_modern',
              data: {
                tempat: 'Loft perkotaan minimalis dengan pemandangan kota modern',
                waktu: 'Senja',
                subjek: 'Seorang profesional muda yang karismatik berinteraksi dengan tablet futuristik',
                aksi: 'Menggunakan tablet untuk desain 3D yang mulus, lalu mempresentasikannya di layar hologram',
                ekspresi: 'Percaya diri, inovatif',
                gayaVideo: 'Gaya Sinematik (Film)',
                sudutKamera: 'Medium Shot (Setengah Badan)',
                gerakanKamera: 'Zoom In (Perbesar)',
                pencahayaan: 'Cahaya Neon, modern, dramatis dari layar',
                suasanaVideo: 'Inspiratif, canggih, profesional',
                aspekRasio: '16:9',
                backsound: 'Musik elektronik yang bersih dan dinamis',
                teksDialogAktor: 'Masa Depan ada di tangan Anda.',
                durasiVideo: '30',
                fps: '30',
                detailTambahan: 'Desain interior ramping, pencahayaan LED, antarmuka pengguna holografik, kota yang sibuk di latar belakang'
              }
            },
            {
              label: 'Iklan Makanan/Minuman (Segar & Lezat)',
              value: 'ad_food_fresh',
              data: {
                tempat: 'Meja kayu rustik di dapur yang hangat dan terang',
                waktu: 'Siang Hari',
                subjek: 'Tangan-tangan cekatan sedang menyiapkan salad buah tropis yang berwarna-warni',
                aksi: 'Mengiris buah-buahan segar, menata dalam mangkuk kaca, menuangkan saus madu kental',
                ekspresi: 'Tidak ada ekspresi (fokus pada tangan)',
                gayaVideo: 'Realistis (Fotografi)',
                sudutKamera: 'Close-up (Jarak Dekat)',
                gerakanKamera: 'Statik (Diam)',
                pencahayaan: 'Cahaya Alami, lembut, hangat',
                suasanaVideo: 'Menenangkan, menggiurkan, sehat',
                aspekRasio: '1:1', // Instagram/Reel friendly
                backsound: 'Musik akustik ceria, suara mengiris buah, suara guyuran saus',
                teksDialogAktor: 'Setiap gigitan adalah kesegaran alami.',
                durasiVideo: '20',
                fps: '30',
                detailTambahan: 'Uap tipis dari buah dingin, tetesan air di buah, detail tekstur buah, wadah kaca berkilau'
              }
            },
            {
              label: 'Iklan Produk Gaya Hidup (Ketenangan/Alam)',
              value: 'ad_lifestyle_nature',
              data: {
                tempat: 'Tepi danau yang tenang di pegunungan, saat matahari terbit',
                waktu: 'Pagi Hari',
                subjek: 'Seorang wanita muda bermeditasi dengan produk yoga ramah lingkungan di sampingnya',
                aksi: 'Bernapas perlahan, melakukan gerakan yoga yang menenangkan, memegang produk dengan lembut',
                ekspresi: 'Tenang, damai, bersyukur',
                gayaVideo: 'Gaya Dokumen',
                sudutKamera: 'Wide Shot (Jarak Jauh)',
                gerakanKamera: 'Pan (Geser Horizontal) lambat',
                pencahayaan: 'Golden Hour (Cahaya Keemasan)',
                suasanaVideo: 'Menenangkan, damai, alami',
                aspekRasio: '16:9',
                backsound: 'Musik ambient yang tenang, suara burung berkicau, air danau',
                teksDialogAktor: 'Temukan kedamaian di setiap momen.',
                durasiVideo: '45',
                fps: '24',
                detailTambahan: 'Kabut tipis di atas danau, pantulan matahari di air, pepohonan hijau yang rimbun, tekstur alami produk'
              }
            },
          ];

          // Fungsi untuk menampilkan pesan pop-up kustom (pengganti alert())
          const showMessageBox = (message, type = 'success') => {
            const messageBox = document.createElement('div');
            messageBox.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
            const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            const btnColor = type === 'success' ? 'bg-green-700' : 'bg-red-700';

            messageBox.innerHTML = `
              <div class="${isDarkMode ? 'bg-gray-800' : 'bg-white text-gray-900'} p-6 rounded-lg shadow-xl text-center">
                <p class="text-lg mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}">${message}</p>
                <button id="closeMessageBox" class="${bgColor} hover:${btnColor} text-white font-bold py-2 px-4 rounded-lg">Oke</button>
              </div>
            `;
            document.body.appendChild(messageBox);
            document.getElementById('closeMessageBox').onclick = () => document.body.removeChild(messageBox);
          };


          // Efek untuk memuat riwayat prompt, favorit, adegan, dan mode gelap dari Local Storage saat komponen di-mount
          React.useEffect(() => {
            const savedHistory = localStorage.getItem('veo3PromptHistory');
            if (savedHistory) {
              setPromptHistory(JSON.parse(savedHistory));
            }

            const savedFavorites = localStorage.getItem('veo3FavoritePrompts');
            if (savedFavorites) {
              setFavoritePrompts(JSON.parse(savedFavorites));
            }

            const savedScenes = localStorage.getItem('veo3Scenes');
            if (savedScenes) {
              setScenes(JSON.parse(savedScenes));
            }

            const savedDarkMode = localStorage.getItem('veo3DarkMode');
            if (savedDarkMode !== null) {
              setIsDarkMode(JSON.parse(savedDarkMode));
            }
          }, []);

          // Efek untuk menyimpan riwayat prompt, favorit, adegan, dan mode gelap ke Local Storage setiap kali berubah
          React.useEffect(() => {
            localStorage.setItem('veo3PromptHistory', JSON.stringify(promptHistory));
          }, [promptHistory]);

          React.useEffect(() => {
            localStorage.setItem('veo3FavoritePrompts', JSON.stringify(favoritePrompts));
          }, [favoritePrompts]);

          React.useEffect(() => {
            localStorage.setItem('veo3Scenes', JSON.stringify(scenes));
          }, [scenes]);

          React.useEffect(() => {
            localStorage.setItem('veo3DarkMode', JSON.stringify(isDarkMode));
          }, [isDarkMode]);

          // Fungsi untuk mengatur ulang semua input form
          const resetForm = () => {
            setSubjek('');
            setAksi('');
            setEkspresi('');
            setTempat('');
            setWaktu('');
            setSudutKamera('');
            setGerakanKamera('');
            setPencahayaan('');
            setGayaVideo('');
            setAspekRasio('');
            setSuasanaVideo('');
            setBacksound('');
            setBahasaAktor('');
            setTeksDialogAktor('');
            setDurasiVideo('');
            setFps('');
            setDetailTambahan('');
            setGeneratedPrompt('');
            setEnhancedPrompt('');
            setImageFile(null);
            setImageUrl('');
            setPromptDariGambar('');
            setImageError('');
            setEnhanceError('');
            setMixedPrompt(''); // Clear mixed prompt
            setSelectedPromptsForMixer([]); // Clear mixer selection
            setEvolvedPrompts([]); // Clear evolved prompts
            setEvolveError(''); // Clear evolve error
          };

          // Fungsi untuk menghasilkan prompt utama
          const generatePrompt = React.useCallback(() => {
            let prompt = '';
            const parts = [];

            if (tempat) parts.push(`Tempat: ${tempat}`);
            if (waktu) parts.push(`Waktu: ${waktu}`);
            if (subjek) parts.push(`Subjek: ${subjek}`);
            if (ekspresi) parts.push(`Ekspresi: ${ekspresi}`);
            if (aksi) parts.push(`Aksi: ${aksi}`);
            if (gayaVideo) parts.push(`Gaya Video: ${gayaVideo}`);
            if (sudutKamera) parts.push(`Sudut Kamera: ${sudutKamera}`);
            if (gerakanKamera) parts.push(`Gerakan Kamera: ${gerakanKamera}`);
            if (pencahayaan) parts.push(`Pencahayaan: ${pencahayaan}`);
            if (suasanaVideo) parts.push(`Suasana Video: ${suasanaVideo}`);
            if (aspekRasio) parts.push(`Aspek Rasio: ${aspekRasio}`);
            if (bahasaAktor) parts.push(`Bahasa Suara Aktor: ${bahasaAktor}`);
            if (teksDialogAktor) parts.push(`Teks Dialog Aktor: "${teksDialogAktor}"`);
            if (backsound) parts.push(`Backsound: ${backsound}`);
            if (durasiVideo) parts.push(`Durasi Video: ${durasiVideo} detik`);
            if (fps) parts.push(`FPS: ${fps}`);
            if (detailTambahan) parts.push(`Detail Tambahan: ${detailTambahan}`);

            if (parts.length > 0) {
              prompt = parts.join(', ') + '.';
            } else {
              prompt = 'Mohon isi setidaknya satu kolom untuk menghasilkan prompt.';
            }

            setGeneratedPrompt(prompt);
            setEnhancedPrompt('');
            setEnhanceError('');
            setEvolvedPrompts([]); // Clear evolved prompts when new base prompt is generated
            setEvolveError('');
          }, [subjek, aksi, ekspresi, tempat, waktu, sudutKamera, gerakanKamera, pencahayaan, gayaVideo, aspekRasio, suasanaVideo, backsound, bahasaAktor, teksDialogAktor, durasiVideo, fps, detailTambahan]);


          // Fungsi untuk menyalin prompt utama ke clipboard
          const copyToClipboard = (textToCopy, setDisplayMessage) => {
            if (textToCopy) {
              const textarea = document.createElement('textarea');
              textarea.value = textToCopy;
              document.body.appendChild(textarea);
              textarea.select();
              try {
                document.execCommand('copy');
                if (setDisplayMessage) {
                  setDisplayMessage(true);
                  setTimeout(() => setDisplayMessage(false), 2000);
                }
              } catch (err) {
                console.error('Gagal menyalin:', err);
              } finally {
                document.body.removeChild(textarea);
              }
            }
          };

          // Handler untuk unggah file gambar
          const handleImageUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
              setImageFile(file);
              setImageError('');
              const reader = new FileReader();
              reader.onloadend = () => {
                setImageUrl(reader.result);
              };
              reader.readAsDataURL(file);
            } else {
              setImageFile(null);
              setImageUrl('');
            }
          };

          // Fungsi untuk menganalisis gambar menggunakan Gemini API dan menghasilkan prompt Veo 3
          const analyzeImage = async () => {
            if (!imageFile) {
              showMessageBox('Mohon unggah gambar terlebih dahulu.', 'error');
              return;
            }

            setIsAnalyzingImage(true);
            setPromptDariGambar('');
            setImageError('');

            try {
              const reader = new FileReader();
              reader.readAsDataURL(imageFile);
              reader.onloadend = async () => {
                const base64ImageData = reader.result.split(',')[1];

                let chatHistory = [];
                const promptInstruction = `Buat prompt teks-ke-video yang sangat detail dan terstruktur untuk model Veo 3 berdasarkan gambar ini. Prompt harus sepenuhnya dalam ${bahasaOutputPrompt} dan mencakup poin-poin berikut:
1.  **Tempat (Latar Belakang):** Deskripsikan lingkungan atau lokasi.
2.  **Waktu Hari:** Perkirakan waktu hari (pagi, siang, sore, malam, senja, fajar).
3.  **Subjek:** Siapa atau apa yang menjadi fokus utama, deskripsikan penampilan dan detail relevan.
4.  **Ekspresi (Emosi):** Jika ada subjek dengan wajah, deskripsikan ekspresi atau emosinya.
5.  **Aksi (Apa yang Terjadi):** Jelaskan pergerakan, interaksi, atau peristiwa yang terjadi.
6.  **Gaya Video:** Apa gaya visual gambar ini (misalnya, realistis, animasi kartun 2D, animasi 3D, sinematik, seni digital, surealis, gaya anime, gaya lukisan air, pixel art)?
7.  **Sudut Kamera:** Bagaimana adegan dibingkai (misalnya, wide shot, close-up, medium shot, low angle, bird's eye view)?
8.  **Gerakan Kamera:** Apakah ada indikasi gerakan kamera (misalnya, statik, pan, tilt, zoom, tracking shot)?
9.  **Pencahayaan:** Bagaimana pencahayaan di adegan ini (misalnya, cahaya alami, dramatis, lembut, neon, golden hour)?
10. **Suasana Video:** Suasana atau mood apa yang ingin disampaikan (misalnya, bahagia, sedih, misterius, menenangkan, ceria)?
11. **Aspek Rasio:** Jika ada indikasi, perkirakan aspek rasio (16:9, 9:16, 4:3, 1:1).
12. **Backsound/Musik Latar:** (Jika ada, deskripsikan jenis backsound atau musik latar yang mungkin cocok.)
13. **Teks Dialog Suara Aktor:** (Jika gambar mengimplikasikan adanya percakapan atau narasi, berikan contoh singkat atau deskripsikan sifat dialognya. Jika tidak ada dialog yang jelas terlihat, nyatakan "Tidak ada dialog yang jelas terlihat.")
14. **Durasi Video:** (Perkirakan durasi video yang masuk akal berdasarkan kompleksitas adegan.)
15. **FPS (Frame per Detik):** (Sarankan FPS yang realistis, misalnya 24 atau 30.)
16. **Detail Tambahan:** Elemen visual kecil lainnya, tekstur, atau objek spesifik.

Format hasilnya sebagai satu paragraf prompt ${bahasaOutputPrompt} yang siap digunakan, pisahkan setiap poin dengan koma. Contoh: "Tempat: hutan ajaib, Waktu: malam hari, Subjek: naga bersisik biru, Aksi: terbang di atas pohon, Gaya Video: gaya Studio Ghibli, Sudut Kamera: wide shot, Gerakan Kamera: pan lambat, Pencahayaan: cahaya bulan lembut, Suasana Video: magis, Aspek Rasio: 16:9, Backsound: musik orkestra, Teks Dialog Aktor: 'Hai, dunia!', Durasi Video: 10 detik, FPS: 24, Detail Tambahan: kunang-kunang bersinar."
`;

                chatHistory.push({ role: "user", parts: [{ text: promptInstruction }] });
                const payload = {
                    contents: [
                        {
                            role: "user",
                            parts: [
                                { text: promptInstruction },
                                {
                                    inlineData: {
                                        mimeType: imageFile.type,
                                        data: base64ImageData
                                    }
                                }
                            ]
                        }
                    ],
                };

                const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                  const text = result.candidates[0].content.parts[0].text;
                  setPromptDariGambar(text);
                } else {
                  setImageError('Gagal mendapatkan prompt dari gambar. Format respons tidak sesuai.');
                }
              };
            } catch (error) {
              console.error('Error analyzing image:', error);
              setImageError('Terjadi kesalahan saat menganalisis gambar. Silakan coba lagi.');
            } finally {
              setIsAnalyzingImage(false);
            }
          };

          // Fungsi untuk menambahkan prompt yang dihasilkan ke riwayat
          const addPromptToHistory = (prompt) => {
            if (prompt && prompt !== 'Mohon isi setidaknya satu kolom untuk menghasilkan prompt.') {
              const newHistory = [{ prompt: prompt, timestamp: new Date().toLocaleString(), isFavorite: false }, ...promptHistory];
              setPromptHistory(newHistory.slice(0, 10)); // Batasi riwayat hingga 10 item terakhir
              showMessageBox('Prompt berhasil ditambahkan ke riwayat!');
            } else {
              showMessageBox('Prompt kosong atau tidak valid, tidak bisa ditambahkan ke riwayat.', 'error');
            }
          };

          // Fungsi untuk memuat prompt dari riwayat ke form input
          const loadPromptFromHistory = (index) => {
            const item = promptHistory[index];
            if (item) {
              const parts = item.prompt.split(', ').map(p => p.trim());
              resetForm();
              parts.forEach(part => {
                if (part.startsWith('Tempat:')) setTempat(part.replace('Tempat: ', ''));
                else if (part.startsWith('Waktu:')) setWaktu(part.replace('Waktu: ', ''));
                else if (part.startsWith('Subjek:')) setSubjek(part.replace('Subjek: ', ''));
                else if (part.startsWith('Ekspresi:')) setEkspresi(part.replace('Ekspresi: ', ''));
                else if (part.startsWith('Aksi:')) setAksi(part.replace('Aksi: ', ''));
                else if (part.startsWith('Gaya Video:')) setGayaVideo(part.replace('Gaya Video: ', ''));
                else if (part.startsWith('Sudut Kamera:')) setSudutKamera(part.replace('Sudut Kamera: ', ''));
                else if (part.startsWith('Gerakan Kamera:')) setGerakanKamera(part.replace('Gerakan Kamera: ', ''));
                else if (part.startsWith('Pencahayaan:')) setPencahayaan(part.replace('Pencahayaan: ', ''));
                else if (part.startsWith('Suasana Video:')) setSuasanaVideo(part.replace('Suasana Video: ', ''));
                else if (part.startsWith('Aspek Rasio:')) setAspekRasio(part.replace('Aspek Rasio: ', ''));
                else if (part.startsWith('Bahasa Suara Aktor:')) setBahasaAktor(part.replace('Bahasa Suara Aktor: ', ''));
                else if (part.startsWith('Teks Dialog Aktor:')) setTeksDialogAktor(part.replace('Teks Dialog Aktor: "', '').replace('"', ''));
                else if (part.startsWith('Backsound:')) setBacksound(part.replace('Backsound: ', ''));
                else if (part.startsWith('Durasi Video:')) setDurasiVideo(part.replace('Durasi Video: ', '').replace(' detik', ''));
                else if (part.startsWith('FPS:')) setFps(part.replace('FPS: ', ''));
                else if (part.startsWith('Detail Tambahan:')) setDetailTambahan(part.replace('Detail Tambahan: ', '').replace('.', ''));
              });
              setGeneratedPrompt(item.prompt); // Juga set prompt yang dihasilkan
              showMessageBox(`Prompt dari riwayat dimuat: ${item.timestamp}`);
            }
          };

          // Fungsi untuk menghapus prompt dari riwayat
          const deletePromptFromHistory = (index) => {
            const newHistory = promptHistory.filter((_, i) => i !== index);
            setPromptHistory(newHistory);
            showMessageBox('Prompt berhasil dihapus dari riwayat.');
          };

          // Fungsi untuk menandai prompt sebagai favorit
          const toggleFavorite = (promptItem, type) => {
            let updatedList;
            let setList;
            
            // Determine which list to update based on type
            if (type === 'history') {
                updatedList = promptHistory.map(item =>
                    item === promptItem ? { ...item, isFavorite: !item.isFavorite } : item
                );
                setList = setPromptHistory;
            } else if (type === 'scene') {
                updatedList = scenes.map(item =>
                    item === promptItem ? { ...item, isFavorite: !item.isFavorite } : item
                );
                setList = setScenes;
            } else if (type === 'generated') {
                // If generated prompt is being favorited, find its instance in history/scenes
                // or create a new entry if it doesn't exist yet.
                const existingInHistory = promptHistory.find(item => item.prompt === promptItem.prompt);
                const existingInScenes = scenes.find(item => item.prompt === promptItem.prompt);

                if (existingInHistory) {
                    setPromptHistory(prevHistory => prevHistory.map(item =>
                        item.prompt === promptItem.prompt ? { ...item, isFavorite: !item.isFavorite } : item
                    ));
                    promptItem.isFavorite = !existingInHistory.isFavorite; // Update local item status for next step
                } else if (existingInScenes) {
                    setScenes(prevScenes => prevScenes.map(item =>
                        item.prompt === promptItem.prompt ? { ...item, isFavorite: !item.isFavorite } : item
                    ));
                    promptItem.isFavorite = !existingInScenes.isFavorite; // Update local item status for next step
                } else {
                    // If it's a completely new prompt, add it to history as favorite
                    const newPrompt = { prompt: promptItem.prompt, timestamp: new Date().toLocaleString(), isFavorite: true };
                    setPromptHistory(prevHistory => [newPrompt, ...prevHistory].slice(0, 10));
                    setFavoritePrompts(prev => [newPrompt, ...prev]);
                    showMessageBox('Prompt ditambahkan ke favorit!');
                    return; // Exit as this case is handled
                }
            }

            if (updatedList) {
                setList(updatedList);
                // Update favoritePrompts list based on the new isFavorite status of the item
                if (promptItem.isFavorite) { // If it's now favorite
                    setFavoritePrompts(prev => [...prev.filter(item => item.prompt !== promptItem.prompt), promptItem]);
                    showMessageBox('Prompt ditambahkan ke favorit!');
                } else { // If it's now not favorite
                    setFavoritePrompts(prev => prev.filter(item => item.prompt !== promptItem.prompt));
                    showMessageBox('Prompt dihapus dari favorit.');
                }
            }
          };


          // Fungsi untuk memuat prompt dari favorit ke form input
          const loadFavoritePrompt = (index) => {
            const item = favoritePrompts[index];
            if (item) {
              const parts = item.prompt.split(', ').map(p => p.trim());
              resetForm();
              parts.forEach(part => {
                if (part.startsWith('Tempat:')) setTempat(part.replace('Tempat: ', ''));
                else if (part.startsWith('Waktu:')) setWaktu(part.replace('Waktu: ', ''));
                else if (part.startsWith('Subjek:')) setSubjek(part.replace('Subjek: ', ''));
                else if (part.startsWith('Ekspresi:')) setEkspresi(part.replace('Ekspresi: ', ''));
                else if (part.startsWith('Aksi:')) setAksi(part.replace('Aksi: ', ''));
                else if (part.startsWith('Gaya Video:')) setGayaVideo(part.replace('Gaya Video: ', ''));
                else if (part.startsWith('Sudut Kamera:')) setSudutKamera(part.replace('Sudut Kamera: ', ''));
                else if (part.startsWith('Gerakan Kamera:')) setGerakanKamera(part.replace('Gerakan Kamera: ', ''));
                else if (part.startsWith('Pencahayaan:')) setPencahayaan(part.replace('Pencahayaan: ', ''));
                else if (part.startsWith('Suasana Video:')) setSuasanaVideo(part.replace('Suasana Video: ', ''));
                else if (part.startsWith('Aspek Rasio:')) setAspekRasio(part.replace('Aspek Rasio: ', ''));
                else if (part.startsWith('Bahasa Suara Aktor:')) setBahasaAktor(part.replace('Bahasa Suara Aktor: ', ''));
                else if (part.startsWith('Teks Dialog Aktor:')) setTeksDialogAktor(part.replace('Teks Dialog Aktor: "', '').replace('"', ''));
                else if (part.startsWith('Backsound:')) setBacksound(part.replace('Backsound: ', ''));
                else if (part.startsWith('Durasi Video:')) setDurasiVideo(part.replace('Durasi Video: ', '').replace(' detik', ''));
                else if (part.startsWith('FPS:')) setFps(part.replace('FPS: ', ''));
                else if (part.startsWith('Detail Tambahan:')) setDetailTambahan(part.replace('Detail Tambahan: ', '').replace('.', ''));
              });
              setGeneratedPrompt(item.prompt);
              showMessageBox(`Prompt favorit dimuat: ${item.timestamp}`);
            }
          };

          // Fungsi untuk menghapus prompt dari favorit
          const deleteFavoritePrompt = (index) => {
            const itemToDelete = favoritePrompts[index];
            const newFavorites = favoritePrompts.filter((_, i) => i !== index);
            setFavoritePrompts(newFavorites);

            // Also update its favorite status in history/scenes if it exists there
            setPromptHistory(prevHistory => prevHistory.map(item =>
              item.prompt === itemToDelete.prompt ? { ...item, isFavorite: false } : item
            ));
            setScenes(prevScenes => prevScenes.map(item =>
              item.prompt === itemToDelete.prompt ? { ...item, isFavorite: false } : item
            ));

            showMessageBox('Prompt berhasil dihapus dari favorit.');
          };


          // Handler untuk memilih template
          const handleTemplateSelect = (event) => {
            const selectedTemplateValue = event.target.value;
            const template = promptTemplates.find(t => t.value === selectedTemplateValue);
            if (template && template.data) {
              resetForm();
              setTempat(template.data.tempat || '');
              setWaktu(template.data.waktu || '');
              setSubjek(template.data.subjek || '');
              setEkspresi(template.data.ekspresi || '');
              setAksi(template.data.aksi || '');
              setGayaVideo(template.data.gayaVideo || '');
              setSudutKamera(template.data.sudutKamera || '');
              setGerakanKamera(template.data.gerakanKamera || '');
              setPencahayaan(template.data.pencahayaan || '');
              setSuasanaVideo(template.data.suasanaVideo || '');
              setAspekRasio(template.data.aspekRasio || '');
              setBacksound(template.data.backsound || '');
              setBahasaAktor(template.data.bahasaAktor || '');
              setTeksDialogAktor(template.data.teksDialogAktor || '');
              setDurasiVideo(template.data.durasiVideo || '');
              setFps(template.data.fps || '');
              setDetailTambahan(template.data.detailTambahan || '');
              setTimeout(generatePrompt, 0);
            } else {
              resetForm();
            }
          };

          // Fungsi untuk Penyempurna Prompt Otomatis
          const enhancePrompt = async () => {
            if (!generatedPrompt || generatedPrompt === 'Mohon isi setidaknya satu kolom untuk menghasilkan prompt.') {
              showMessageBox('Mohon hasilkan prompt terlebih dahulu sebelum menyempurnakannya.', 'error');
              return;
            }

            setIsEnhancingPrompt(true);
            setEnhanceError('');
            setEnhancedPrompt('');
            setEvolvedPrompts([]); // Clear evolved prompts when enhancing

            try {
              let chatHistory = [];
              const promptInstruction = `Sempurnakan prompt Veo 3 berikut dalam ${bahasaOutputPrompt}. Tambahkan detail visual, deskripsi yang lebih kaya, dan gaya bahasa yang lebih kuat, tetapi pertahankan makna inti dan struktur informasi yang sudah ada. Fokus pada visual, gerakan, suasana, dan gaya video. Prompt asli: "${generatedPrompt}"`;

              chatHistory.push({ role: "user", parts: [{ text: promptInstruction }] });
              const payload = { contents: chatHistory };

              const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
              const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

              const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });

              const result = await response.json();
              if (result.candidates && result.candidates.length > 0 &&
                  result.candidates[0].content && result.candidates[0].content.parts &&
                  result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                setEnhancedPrompt(text);
                showMessageBox('Prompt berhasil disempurnakan!');
              } else {
                setEnhanceError('Gagal menyempurnakan prompt. Format respons tidak sesuai.');
                showMessageBox('Gagal menyempurnakan prompt.', 'error');
              }
            } catch (error) {
              console.error('Error enhancing prompt:', error);
              setEnhanceError('Terjadi kesalahan saat menyempurnakan prompt. Silakan coba lagi.');
              showMessageBox('Terjadi kesalahan saat menyempurnakan prompt.', 'error');
            } finally {
              setIsEnhancingPrompt(false);
            }
          };

          // Fungsi untuk Evolusi Prompt
          const evolvePrompt = async () => {
            const basePrompt = enhancedPrompt || generatedPrompt; // Gunakan enhanced jika ada, kalau tidak pakai generated
            if (!basePrompt || basePrompt === 'Mohon isi setidaknya satu kolom untuk menghasilkan prompt.') {
              showMessageBox('Mohon hasilkan atau sempurnakan prompt terlebih dahulu untuk berevolusi.', 'error');
              return;
            }

            setIsEvolvingPrompt(true);
            setEvolveError('');
            setEvolvedPrompts([]);

            try {
              let chatHistory = [];
              const promptInstruction = `Hasilkan 3-5 variasi prompt Veo 3 yang unik dan kreatif berdasarkan prompt asli berikut dalam ${bahasaOutputPrompt}. Setiap variasi harus sedikit berbeda dalam subjek, aksi, suasana, atau gaya visual, tetapi tetap relevan dengan tema inti. Format setiap variasi sebagai paragraf terpisah. Pisahkan setiap variasi dengan tanda "---".
Prompt Asli: "${basePrompt}"`;

              chatHistory.push({ role: "user", parts: [{ text: promptInstruction }] });
              const payload = { contents: chatHistory };

              const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
              const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

              const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });

              const result = await response.json();
              if (result.candidates && result.candidates.length > 0 &&
                  result.candidates[0].content && result.candidates[0].content.parts &&
                  result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                const variations = text.split('---').map(v => v.trim()).filter(v => v.length > 0);
                setEvolvedPrompts(variations);
                showMessageBox(`Ditemukan ${variations.length} variasi prompt baru!`);
              } else {
                setEvolveError('Gagal berevolusi prompt. Format respons tidak sesuai.');
                showMessageBox('Gagal berevolusi prompt.', 'error');
              }
            } catch (error) {
              console.error('Error evolving prompt:', error);
              setEvolveError('Terjadi kesalahan saat berevolusi prompt. Silakan coba lagi.');
              showMessageBox('Terjadi kesalahan saat berevolusi prompt.', 'error');
            } finally {
              setIsEvolvingPrompt(false);
            }
          };


          // Manajemen Multi-Adegan
          const addCurrentPromptAsScene = () => {
            const promptToAdd = generatedPrompt || enhancedPrompt || promptDariGambar; // Prioritize enhanced, then generated, then image prompt
            if (promptToAdd && promptToAdd !== 'Mohon isi setidaknya satu kolom untuk menghasilkan prompt.') {
              const newScene = {
                id: Date.now(), // ID unik
                prompt: promptToAdd,
                timestamp: new Date().toLocaleString(),
                isFavorite: false // Inisialisasi sebagai bukan favorit
              };
              const updatedScenes = [...scenes, newScene];
              setScenes(updatedScenes);
              setCurrentSceneIndex(updatedScenes.length - 1); // Set sebagai adegan aktif
              showMessageBox('Prompt berhasil ditambahkan sebagai adegan!');
            } else {
              showMessageBox('Mohon hasilkan prompt terlebih dahulu sebelum menambahkan sebagai adegan.', 'error');
            }
          };

          const loadScene = (index) => {
            const sceneToLoad = scenes[index];
            if (sceneToLoad) {
              setGeneratedPrompt(sceneToLoad.prompt);
              setCurrentSceneIndex(index);
              showMessageBox(`Adegan '${sceneToLoad.timestamp}' dimuat ke area output.`);
            }
          };

          const deleteScene = (index) => {
            const newScenes = scenes.filter((_, i) => i !== index);
            setScenes(newScenes);
            if (currentSceneIndex === index) {
              setCurrentSceneIndex(null); // Clear active scene if deleted
            } else if (currentSceneIndex > index) {
              setCurrentSceneIndex(currentSceneIndex - 1); // Adjust index if a previous scene was deleted
            }
            showMessageBox('Adegan berhasil dihapus.');
          };

          const generateCombinedStoryPrompt = () => {
            if (scenes.length === 0) {
              showMessageBox('Tidak ada adegan dalam daftar cerita.', 'error');
              return;
            }
            const combined = scenes.map((scene, index) => `Adegan ${index + 1}: ${scene.prompt}`).join('\n\n');
            setGeneratedPrompt(combined); // Tampilkan di area generated prompt
            showMessageBox('Prompt cerita gabungan telah dibuat di area output.');
          };

          // Fungsi untuk menghasilkan prompt acak
          const generateRandomPrompt = () => {
            const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)].value || arr[Math.floor(Math.random() * arr.length)];
            const getRandomText = (arr) => arr[Math.floor(Math.random() * arr.length)];

            // Using random text for dropdowns to make them truly random, not just existing values
            setTempat(getRandomText(['kota metropolitan', 'hutan belantara', 'pulau tropis', 'laboratorium futuristik', 'desa kuno', 'angkasa luar']));
            setWaktu(getRandom(pilihanWaktu));
            setSubjek(getRandomText(randomSubjects));
            setAksi(getRandomText(randomActions));
            setEkspresi(getRandomText(randomExpressions));
            setGayaVideo(getRandom(pilihanGayaVideo));
            setSudutKamera(getRandom(pilihanSudutKamera));
            setGerakanKamera(getRandom(pilihanGerakanKamera));
            setPencahayaan(getRandom(pilihanPencahayaan));
            setSuasanaVideo(getRandom(pilihanSuasanaVideo));
            setAspekRasio(getRandom(pilihanAspekRasio));
            setBacksound(getRandomText(randomBacksounds));
            setBahasaAktor(getRandom(pilihanBahasaAktor));
            setTeksDialogAktor(getRandomText(randomDialogs));
            setDurasiVideo(String(Math.floor(Math.random() * 30) + 5)); // 5-34 seconds
            setFps(Math.random() > 0.5 ? '24' : '30');
            setDetailTambahan(getRandomText(randomDetails));

            setTimeout(generatePrompt, 0); // Generate prompt after state updates
            showMessageBox('Formulir diisi dengan ide acak!');
          };

          // Fungsi untuk mendapatkan kelas background berdasarkan mode gelap/terang dan waktu
          const getBackgroundClass = () => {
            if (isDarkMode) {
              return 'bg-gradient-to-br from-purple-800 via-indigo-900 to-blue-900';
            } else {
              switch (waktu) {
                case 'pagi hari': return 'bg-gradient-to-br from-blue-200 via-sky-300 to-cyan-400';
                case 'siang hari': return 'bg-gradient-to-br from-sky-400 via-blue-400 to-indigo-500';
                case 'sore hari': return 'bg-gradient-to-br from-orange-200 via-rose-300 to-pink-400';
                case 'senja': return 'bg-gradient-to-br from-red-300 via-orange-400 to-yellow-500';
                case 'malam hari': return 'bg-gradient-to-br from-gray-700 via-indigo-800 to-blue-900'; // Still dark-ish
                case 'fajar': return 'bg-gradient-to-br from-purple-200 via-indigo-300 to-pink-400';
                default: return 'bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300';
              }
            }
          };

          // Fungsi untuk mendapatkan ikon suasana video
          const getSuasanaEmoji = (suasana) => {
            switch (suasana) {
              case 'Bahagia': return '😊';
              case 'Sedih': return '😢';
              case 'Misterius': return '❓';
              case 'Menenangkan': return '🍃';
              case 'Ceria': return '🥳';
              case 'Tegang': return '😬';
              case 'Epik': return '✨';
              case 'Romantis': return '❤️';
              case 'Horor': return '👻';
              case 'Humor': return '😂';
              default: return '';
            }
          };

          // Fungsi untuk mendapatkan ikon gaya video
          const getGayaVideoEmoji = (gaya) => {
            switch (gaya) {
              case 'Realistis (Fotografi)': return '📸';
              case 'Animasi Kartun 2D': return '📺';
              case 'Animasi 3D': return '🧊';
              case 'Gaya Sinematik (Film)': return '🎬';
              case 'Gaya Dokumen': return '🎥';
              case 'Seni Digital': return '🎨';
              case 'Surealis': return '🌌';
              case 'Gaya Anime': return '🌸';
              case 'Gaya Lukisan Air': return '🖌️';
              case 'Pixel Art': return '👾';
              default: return '';
            }
          };

          // Handler untuk memilih prompt untuk mixer
          const handleMixerSelection = (prompt) => {
            setSelectedPromptsForMixer(prevSelected => {
              if (prevSelected.includes(prompt)) {
                return prevSelected.filter(p => p !== prompt);
              } else {
                return [...prevSelected, prompt];
              }
            });
          };

          // Fungsi untuk menggabungkan prompt yang dipilih menggunakan AI (Prompt Mixer)
          const combineSelectedPrompts = async () => {
            if (selectedPromptsForMixer.length < 2) {
              showMessageBox('Pilih setidaknya 2 prompt untuk digabungkan.', 'error');
              return;
            }

            setIsMixingPrompts(true);
            setMixError('');
            setMixedPrompt('');

            try {
              let chatHistory = [];
              const promptsToCombine = selectedPromptsForMixer.map((p, idx) => `Prompt ${idx + 1}: ${p}`).join('\n');
              const promptInstruction = `Gabungkan prompt-prompt Veo 3 berikut menjadi satu prompt yang kohesif dan kreatif dalam bahasa ${bahasaOutputPrompt}. Pastikan semua elemen kunci dari setiap prompt (tempat, subjek, aksi, gaya, dll.) dipertimbangkan dan diintegrasikan secara logis. Fokus pada menghasilkan satu visi video yang unik.

Prompt-prompt yang dipilih:
${promptsToCombine}

Hasilkan satu prompt gabungan yang detail dan siap digunakan.`;

              chatHistory.push({ role: "user", parts: [{ text: promptInstruction }] });
              const payload = { contents: chatHistory };

              const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
              const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

              const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });

              const result = await response.json();
              if (result.candidates && result.candidates.length > 0 &&
                  result.candidates[0].content && result.candidates[0].content.parts &&
                  result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                setMixedPrompt(text);
                showMessageBox('Prompt berhasil digabungkan!');
              } else {
                setMixError('Gagal menggabungkan prompt. Format respons tidak sesuai.');
                showMessageBox('Gagal menggabungkan prompt.', 'error');
              }
            } catch (error) {
              console.error('Error mixing prompts:', error);
              setMixError('Terjadi kesalahan saat menggabungkan prompt. Silakan coba lagi.');
              showMessageBox('Terjadi kesalahan saat menggabungkan prompt.', 'error');
            } finally {
              setIsMixingPrompts(false);
            }
          };


          return (
            <div className={`min-h-screen ${getBackgroundClass()} text-white p-4 sm:p-8 font-sans flex flex-col items-center transition-colors duration-500`}>
              <style>{`
                body {
                  font-family: 'Inter', sans-serif;
                }
                textarea::-webkit-scrollbar {
                  width: 8px;
                  height: 8px;
                }
                textarea::-webkit-scrollbar-thumb {
                  background-color: ${isDarkMode ? '#888' : '#bbb'};
                  border-radius: 4px;
                }
                textarea::-webkit-scrollbar-track {
                  background-color: ${isDarkMode ? '#f1f1f1' : '#eee'};
                  border-radius: 4px;
                }
                /* Custom checkbox style */
                input[type="checkbox"] {
                  appearance: none;
                  -webkit-appearance: none;
                  -moz-appearance: none;
                  width: 20px;
                  height: 20px;
                  border: 2px solid ${isDarkMode ? '#6B7280' : '#D1D5DB'};
                  border-radius: 4px;
                  cursor: pointer;
                  position: relative;
                  vertical-align: middle;
                  margin-right: 8px;
                }
                input[type="checkbox"]:checked {
                  background-color: #8B5CF6; /* Purple-500 */
                  border-color: #8B5CF6;
                }
                input[type="checkbox"]:checked::before {
                  content: '✔';
                  display: block;
                  position: absolute;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  color: white;
                  font-size: 14px;
                }
              `}</style>

              <div className={`w-full max-w-4xl rounded-2xl shadow-xl p-6 sm:p-8 transform transition-all duration-300 hover:scale-[1.005] ${isDarkMode ? 'bg-gray-800 bg-opacity-70 text-white' : 'bg-white bg-opacity-90 text-gray-900'}`}>
                <div className="flex justify-between items-center mb-6">
                  <h1 className={`text-3xl sm:text-4xl font-extrabold flex-grow text-center ${isDarkMode ? 'text-purple-300' : 'text-purple-700'}`}>
                    Generator Prompt Veo 3
                  </h1>
                  {/* Tombol Mode Malam/Siang */}
                  <button
                    onClick={() => setIsDarkMode(!isDarkMode)}
                    className={`p-2 rounded-full transition-colors duration-300 ${isDarkMode ? 'bg-gray-700 hover:bg-gray-600 text-yellow-300' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'}`}
                    title={isDarkMode ? 'Ganti ke Mode Siang' : 'Ganti ke Mode Malam'}
                  >
                    {isDarkMode ? '☀️' : '🌙'}
                  </button>
                </div>
                <p className={`text-center mb-8 max-w-2xl mx-auto ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                  Isi detail di bawah ini atau unggah gambar untuk membuat prompt yang terstruktur dan sesuai untuk Veo 3. Semakin detail, semakin baik hasilnya!
                </p>

                {/* Visualisasi Prompt Sederhana */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-green-300' : 'text-green-700'}`}>
                    Visualisasi Prompt Anda
                  </h2>
                  <div className={`p-4 rounded-lg flex flex-col items-center justify-center min-h-[120px] transition-all duration-500
                               ${waktu === 'pagi hari' ? (isDarkMode ? 'bg-sky-900' : 'bg-blue-100') : ''}
                               ${waktu === 'siang hari' ? (isDarkMode ? 'bg-blue-900' : 'bg-sky-200') : ''}
                               ${waktu === 'sore hari' ? (isDarkMode ? 'bg-orange-900' : 'bg-orange-100') : ''}
                               ${waktu === 'senja' ? (isDarkMode ? 'bg-red-900' : 'bg-red-100') : ''}
                               ${waktu === 'malam hari' ? (isDarkMode ? 'bg-indigo-950' : 'bg-gray-700') : ''}
                               ${waktu === 'fajar' ? (isDarkMode ? 'bg-purple-900' : 'bg-purple-100') : ''}
                               ${(!waktu && !isDarkMode) ? 'bg-gray-200' : ''}
                               ${(!waktu && isDarkMode) ? 'bg-gray-800' : ''}
                               `}>
                    <p className="text-5xl my-2">{getSuasanaEmoji(suasanaVideo)} {getGayaVideoEmoji(gayaVideo)}</p>
                    <p className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-800'}`}>
                      {waktu ? `Waktu: ${waktu}` : 'Pilih Waktu'}
                    </p>
                    <p className={`text-sm ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                      {suasanaVideo ? `Suasana: ${suasanaVideo}` : 'Pilih Suasana'}
                    </p>
                    <p className={`text-sm ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                      {gayaVideo ? `Gaya: ${gayaVideo}` : 'Pilih Gaya'}
                    </p>
                  </div>
                </div>

                {/* Bagian Unggah dan Analisis Gambar */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-yellow-300' : 'text-yellow-700'}`}>
                    Unggah Gambar untuk Membuat Prompt
                  </h2>
                  <p className={`text-center mb-4 ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                    Unggah gambar dan AI akan menganalisisnya untuk membuat prompt Veo 3 otomatis dalam Bahasa Indonesia.
                  </p>
                  <div className="flex flex-col items-center justify-center space-y-4">
                    <input
                      type="file"
                      accept="image/*"
                      onChange={handleImageUpload}
                      className={`block w-full text-sm ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-blue-50 file:text-blue-700
                        hover:file:bg-blue-100 cursor-pointer`}
                    />
                    {imageUrl && (
                      <div className="mt-4 flex flex-col items-center">
                        <img src={imageUrl} alt="Pratinjau Gambar" className="max-w-xs max-h-64 rounded-lg shadow-md border-2 border-purple-400" />
                        <p className={`text-sm mt-2 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>Pratinjau Gambar</p>
                      </div>
                    )}

                    <button
                      onClick={analyzeImage}
                      disabled={!imageFile || isAnalyzingImage}
                      className={`mt-4 w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-300 ${(!imageFile || isAnalyzingImage) ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}
                    >
                      {isAnalyzingImage ? (
                        <span className="flex items-center">
                          <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          Menganalisis...
                        </span>
                      ) : (
                        'Buat Prompt dari Gambar'
                      )}
                    </button>
                    {imageError && (
                      <p className="text-red-400 text-sm mt-2">{imageError}</p>
                    )}

                    {promptDariGambar && (
                      <div className={`mt-6 w-full p-4 rounded-lg shadow-inner border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-200 border-gray-300'}`}>
                        <h3 className={`text-lg font-semibold mb-3 ${isDarkMode ? 'text-blue-300' : 'text-blue-700'}`}>Prompt Veo 3 dari Gambar:</h3>
                        <textarea
                          readOnly
                          rows="5"
                          className={`w-full p-2 rounded-md font-mono text-sm resize-none focus:outline-none ${isDarkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-white border-gray-300 text-gray-800'}`}
                          value={promptDariGambar}
                        ></textarea>
                        <button
                          onClick={() => copyToClipboard(promptDariGambar, setShowImagePromptCopyMessage)}
                          className="mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-1.5 px-3 rounded-md transition-all duration-300 text-xs flex items-center justify-center relative"
                        >
                          Salin Prompt Gambar
                          {showImagePromptCopyMessage && (
                            <span className="absolute -top-7 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded-md shadow-lg transition-opacity duration-300 opacity-100 whitespace-nowrap">
                              Disalin!
                            </span>
                          )}
                        </button>
                        <p className={`text-sm mt-3 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                          Anda bisa menyalin prompt ini dan menggunakannya langsung atau mengadaptasinya di kolom di bawah.
                        </p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Pustaka Template Prompt */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-teal-300' : 'text-teal-700'}`}>
                    Pustaka Template Prompt
                  </h2>
                  <div className="flex flex-col items-center justify-center space-y-4">
                    <select
                      id="promptTemplate"
                      className={`w-full p-3 rounded-lg focus:ring-teal-500 focus:border-teal-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-800 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      onChange={handleTemplateSelect}
                      defaultValue=""
                    >
                      {promptTemplates.map((template) => (
                        <option key={template.value} value={template.value}>
                          {template.label}
                        </option>
                      ))}
                    </select>
                    <button
                      onClick={resetForm}
                      className="w-full sm:w-auto bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-300 hover:scale-105"
                    >
                      Reset Formulir
                    </button>
                  </div>
                </div>

                {/* Kolom Pengisian Prompt Manual */}
                <div className={`grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`md:col-span-2 text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-orange-300' : 'text-orange-700'}`}>
                    Formulir Pembuatan Prompt Manual
                  </h2>

                  {/* Opsi Bahasa Output Prompt */}
                  <div className="md:col-span-2 mb-4">
                    <label htmlFor="bahasaOutputPrompt" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Bahasa Output Prompt (AI):
                    </label>
                    <select
                      id="bahasaOutputPrompt"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={bahasaOutputPrompt}
                      onChange={(e) => setBahasaOutputPrompt(e.target.value)}
                    >
                      {pilihanBahasaOutputPrompt.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                    <p className={`text-sm mt-2 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Pilih bahasa untuk prompt yang dihasilkan oleh AI (dari gambar atau penyempurnaan). Prompt manual akan tetap berbahasa Indonesia.
                    </p>
                  </div>

                  {/* Tombol Generator Ide Acak Prompt */}
                  <div className="md:col-span-2 mb-4">
                    <button
                      onClick={generateRandomPrompt}
                      className="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                    >
                      Hasilkan Ide Prompt Acak! 🎲
                    </button>
                    <p className={`text-sm mt-2 text-center ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Klik untuk mengisi formulir dengan ide-ide prompt acak.
                    </p>
                  </div>

                  {/* Tempat (Latar Belakang) */}
                  <div className="mb-4">
                    <label htmlFor="tempat" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Tempat (Latar Belakang):
                    </label>
                    <input
                      type="text"
                      id="tempat"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: Kota futuristik yang ramai"
                      value={tempat}
                      onChange={(e) => setTempat(e.target.value)}
                    />
                  </div>

                  {/* Waktu */}
                  <div className="mb-4">
                    <label htmlFor="waktu" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Waktu:
                    </label>
                    <select
                      id="waktu"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={waktu}
                      onChange={(e) => setWaktu(e.target.value)}
                    >
                      {pilihanWaktu.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Subjek */}
                  <div className="mb-4">
                    <label htmlFor="subjek" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Subjek:
                    </label>
                    <input
                      type="text"
                      id="subjek"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: Seorang wanita muda berambut merah"
                      value={subjek}
                      onChange={(e) => setSubjek(e.target.value)}
                    />
                  </div>

                  {/* Ekspresi (Emosi) */}
                  <div className="mb-4">
                    <label htmlFor="ekspresi" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Ekspresi (Emosi):
                    </label>
                    <input
                      type="text"
                      id="ekspresi"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: Senang, terkejut, melankolis"
                      value={ekspresi}
                      onChange={(e) => setEkspresi(e.target.value)}
                    />
                  </div>

                  {/* Aksi (Apa yang Terjadi) */}
                  <div className="mb-4">
                    <label htmlFor="aksi" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Aksi (Apa yang Terjadi):
                    </label>
                    <input
                      type="text"
                      id="aksi"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: Berjalan melalui iklan holografik"
                      value={aksi}
                      onChange={(e) => setAksi(e.target.value)}
                    />
                  </div>

                  {/* Gaya Video */}
                  <div className="mb-4">
                    <label htmlFor="gayaVideo" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Gaya Video:
                    </label>
                    <select
                      id="gayaVideo"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={gayaVideo}
                      onChange={(e) => setGayaVideo(e.target.value)}
                    >
                      {pilihanGayaVideo.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Sudut Kamera */}
                  <div className="mb-4">
                    <label htmlFor="sudutKamera" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Sudut Kamera:
                    </label>
                    <select
                      id="sudutKamera"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={sudutKamera}
                      onChange={(e) => setSudutKamera(e.target.value)}
                    >
                      {pilihanSudutKamera.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Gerakan Kamera */}
                  <div className="mb-4">
                    <label htmlFor="gerakanKamera" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Gerakan Kamera:
                    </label>
                    <select
                      id="gerakanKamera"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={gerakanKamera}
                      onChange={(e) => setGerakanKamera(e.target.value)}
                    >
                      {pilihanGerakanKamera.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Pencahayaan */}
                  <div className="mb-4">
                    <label htmlFor="pencahayaan" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Pencahayaan:
                    </label>
                    <select
                      id="pencahayaan"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={pencahayaan}
                      onChange={(e) => setPencahayaan(e.target.value)}
                    >
                      {pilihanPencahayaan.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Suasana Video */}
                  <div className="mb-4">
                    <label htmlFor="suasanaVideo" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Suasana Video:
                    </label>
                    <select
                      id="suasanaVideo"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={suasanaVideo}
                      onChange={(e) => setSuasanaVideo(e.target.value)}
                    >
                      {pilihanSuasanaVideo.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Aspek Rasio */}
                  <div className="mb-4">
                    <label htmlFor="aspekRasio" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Aspek Rasio:
                    </label>
                    <select
                      id="aspekRasio"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={aspekRasio}
                      onChange={(e) => setAspekRasio(e.target.value)}
                    >
                      {pilihanAspekRasio.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                  </div>

                  {/* Backsound/Musik Latar */}
                  <div className="mb-4">
                    <label htmlFor="backsound" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Backsound/Musik Latar:
                    </label>
                    <input
                      type="text"
                      id="backsound"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: Musik orkestra epik, suara alam yang menenangkan"
                      value={backsound}
                      onChange={(e) => setBacksound(e.target.value)}
                    />
                  </div>

                  {/* Bahasa Suara Aktor */}
                  <div className="mb-4">
                    <label htmlFor="bahasaAktor" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Bahasa Suara Aktor:
                    </label>
                    <select
                      id="bahasaAktor"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={bahasaAktor}
                      onChange={(e) => setBahasaAktor(e.target.value)}
                    >
                      {pilihanBahasaAktor.map((option) => (
                        <option key={option.value} value={option.value}>{option.label}</option>
                      ))}
                    </select>
                    <p className={`text-sm mt-2 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Pilih bahasa yang diinginkan untuk dialog suara aktor dalam video.
                    </p>
                  </div>

                  {/* Teks Dialog Suara Aktor */}
                  <div className="md:col-span-2 mb-4">
                    <label htmlFor="teksDialogAktor" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Teks Dialog Suara Aktor:
                    </label>
                    <textarea
                      id="teksDialogAktor"
                      rows="3"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: 'Halo, bagaimana kabarmu hari ini?'"
                      value={teksDialogAktor}
                      onChange={(e) => setTeksDialogAktor(e.target.value)}
                    ></textarea>
                    <p className={`text-sm mt-2 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                      Masukkan teks dialog spesifik yang akan diucapkan oleh aktor.
                    </p>
                  </div>

                  {/* Durasi Video (detik) */}
                  <div className="mb-4">
                    <label htmlFor="durasiVideo" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Durasi Video (detik):
                    </label>
                    <input
                      type="number"
                      id="durasiVideo"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: 10"
                      value={durasiVideo}
                      onChange={(e) => setDurasiVideo(e.target.value)}
                    />
                  </div>

                  {/* FPS (Frame per Detik) */}
                  <div className="mb-4">
                    <label htmlFor="fps" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      FPS (Frame per Detik):
                    </label>
                    <input
                      type="number"
                      id="fps"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: 24"
                      value={fps}
                      onChange={(e) => setFps(e.target.value)}
                    />
                  </div>

                  {/* Detail Tambahan */}
                  <div className="md:col-span-2 mb-4">
                    <label htmlFor="detailTambahan" className={`block text-lg font-semibold mb-2 ${isDarkMode ? 'text-purple-200' : 'text-gray-700'}`}>
                      Detail Tambahan:
                    </label>
                    <textarea
                      id="detailTambahan"
                      rows="3"
                      className={`w-full p-3 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 ${isDarkMode ? 'bg-gray-700 border-gray-600 text-gray-100 placeholder-gray-400' : 'bg-white border-gray-300 text-gray-800 placeholder-gray-400'}`}
                      placeholder="Contoh: Iklan holografik bergerak, kendaraan terbang"
                      value={detailTambahan}
                      onChange={(e) => setDetailTambahan(e.target.value)}
                    ></textarea>
                  </div>
                </div>

                {/* Tombol Hasilkan Prompt Utama */}
                <button
                  onClick={generatePrompt}
                  className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 mb-8"
                >
                  Hasilkan Prompt Veo 3
                </button>

                {/* Output Prompt yang Dihasilkan */}
                {generatedPrompt && (
                  <div className={`p-6 rounded-xl shadow-inner border mb-10 ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                    <h2 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-purple-200' : 'text-purple-700'}`}>
                      Prompt Veo 3 yang Dihasilkan:
                    </h2>
                    <textarea
                      readOnly
                      rows="6"
                      className={`w-full p-3 rounded-lg font-mono resize-none focus:outline-none ${isDarkMode ? 'bg-gray-800 border-gray-700 text-gray-200' : 'bg-white border-gray-300 text-gray-800'}`}
                      value={generatedPrompt}
                    ></textarea>
                    <div className="flex flex-wrap gap-3 mt-4">
                      <button
                        onClick={() => copyToClipboard(generatedPrompt, setShowCopyMessage)}
                        className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 text-sm flex items-center justify-center relative"
                      >
                        Salin Prompt
                        {showCopyMessage && (
                          <span className="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded-md shadow-lg transition-opacity duration-300 opacity-100">
                            Disalin!
                          </span>
                        )}
                      </button>
                      <button
                        onClick={() => addPromptToHistory(generatedPrompt)}
                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 text-sm"
                      >
                        Simpan ke Riwayat
                      </button>
                      <button
                        onClick={() => toggleFavorite({ prompt: generatedPrompt, timestamp: new Date().toLocaleString(), isFavorite: favoritePrompts.some(fav => fav.prompt === generatedPrompt) }, 'generated')}
                        className={`py-2 px-4 rounded-lg transition-all duration-300 text-sm flex items-center justify-center
                          ${favoritePrompts.some(fav => fav.prompt === generatedPrompt) ? 'bg-red-500 hover:bg-red-600 text-white' : (isDarkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-100' : 'bg-gray-300 hover:bg-gray-400 text-gray-800')}`}
                      >
                        {favoritePrompts.some(fav => fav.prompt === generatedPrompt) ? '❤️ Favorit' : '♡ Favorit'}
                      </button>
                      <button
                        onClick={enhancePrompt}
                        disabled={isEnhancingPrompt}
                        className={`bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 ${isEnhancingPrompt ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}
                      >
                        {isEnhancingPrompt ? (
                          <span className="flex items-center">
                            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Menyempurnakan...
                          </span>
                        ) : (
                          'Sempurnakan Prompt (AI)'
                        )}
                      </button>
                      <button
                        onClick={evolvePrompt} // Tombol Evolusi Prompt BARU
                        disabled={isEvolvingPrompt}
                        className={`bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 ${isEvolvingPrompt ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}
                      >
                        {isEvolvingPrompt ? (
                          <span className="flex items-center">
                            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Berevolusi...
                          </span>
                        ) : (
                          'Evolusi Prompt (AI)'
                        )}
                      </button>
                      <button
                        onClick={addCurrentPromptAsScene}
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 text-sm"
                      >
                        Tambahkan ke Adegan
                      </button>
                    </div>

                    {/* Enhanced Prompt Output */}
                    {enhancedPrompt && (
                      <div className={`mt-6 p-4 rounded-lg shadow-inner border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-200 border-gray-300'}`}>
                        <h3 className={`text-lg font-semibold mb-2 ${isDarkMode ? 'text-yellow-300' : 'text-yellow-700'}`}>Prompt yang Disempurnakan (AI):</h3>
                        <textarea
                          readOnly
                          rows="5"
                          className={`w-full p-2 rounded-md font-mono text-sm resize-none focus:outline-none ${isDarkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-white border-gray-300 text-gray-800'}`}
                          value={enhancedPrompt}
                        ></textarea>
                        <button
                          onClick={() => copyToClipboard(enhancedPrompt, setShowEnhancedPromptCopyMessage)}
                          className="mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-1.5 px-3 rounded-md transition-all duration-300 text-xs flex items-center justify-center relative"
                        >
                          Salin Prompt Disempurnakan
                          {showEnhancedPromptCopyMessage && (
                            <span className="absolute -top-7 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded-md shadow-lg transition-opacity duration-300 opacity-100 whitespace-nowrap">
                              Disalin!
                            </span>
                          )}
                        </button>
                      </div>
                    )}
                    {enhanceError && (
                      <p className="text-red-400 text-sm mt-2">{enhanceError}</p>
                    )}

                    {/* Evolved Prompts Output */}
                    {evolvedPrompts.length > 0 && (
                      <div className={`mt-6 p-4 rounded-lg shadow-inner border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-200 border-gray-300'}`}>
                        <h3 className={`text-lg font-semibold mb-2 ${isDarkMode ? 'text-orange-300' : 'text-orange-700'}`}>Variasi Prompt Hasil Evolusi (AI):</h3>
                        <div className="space-y-4">
                          {evolvedPrompts.map((evolvedPrompt, idx) => (
                            <div key={idx} className={`p-3 rounded-md border ${isDarkMode ? 'bg-gray-900 border-gray-700' : 'bg-white border-gray-300'}`}>
                              <p className={`text-sm font-mono mb-2 ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>{evolvedPrompt}</p>
                              <button
                                onClick={() => copyToClipboard(evolvedPrompt, setShowEvolvedPromptCopyMessage)}
                                className="mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-2 rounded-md transition-all duration-300 text-xs relative"
                              >
                                Salin Variasi
                                {showEvolvedPromptCopyMessage && (
                                  <span className="absolute -top-7 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded-md shadow-lg transition-opacity duration-300 opacity-100 whitespace-nowrap">
                                    Disalin!
                                  </span>
                                )}
                              </button>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                    {evolveError && (
                      <p className="text-red-400 text-sm mt-2">{evolveError}</p>
                    )}
                  </div>
                )}

                {/* Riwayat Prompt */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    Riwayat Prompt
                  </h2>
                  {promptHistory.length === 0 ? (
                    <p className={`text-center ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>Riwayat prompt Anda akan muncul di sini.</p>
                  ) : (
                    <div className="space-y-3">
                      {promptHistory.map((item, index) => (
                        <div key={index} className={`p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center ${isDarkMode ? 'bg-gray-800' : 'bg-white border border-gray-200'}`}>
                          <div className="flex items-center flex-grow mb-2 sm:mb-0 mr-4">
                            <input
                              type="checkbox"
                              checked={selectedPromptsForMixer.includes(item.prompt)}
                              onChange={() => handleMixerSelection(item.prompt)}
                              className="form-checkbox h-5 w-5 text-purple-600 rounded"
                            />
                            <p className={`text-sm ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                              <span className="font-semibold">{item.timestamp}:</span> {item.prompt.substring(0, 80)}...
                            </p>
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => loadPromptFromHistory(index)}
                              className="bg-purple-500 hover:bg-purple-600 text-white py-1.5 px-3 rounded-md text-xs"
                            >
                              Muat
                            </button>
                            <button
                              onClick={() => toggleFavorite(item, 'history')}
                              className={`py-1.5 px-3 rounded-md text-xs ${item.isFavorite ? 'bg-red-500 hover:bg-red-600 text-white' : (isDarkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-100' : 'bg-gray-300 hover:bg-gray-400 text-gray-800')}`}
                            >
                              {item.isFavorite ? '❤️ Fav' : '♡ Fav'}
                            </button>
                            <button
                              onClick={() => deletePromptFromHistory(index)}
                              className="bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md text-xs"
                            >
                              Hapus
                            </button>
                          </div>
                        </div>
                      ))}
                      <button
                        onClick={combineSelectedPrompts}
                        disabled={selectedPromptsForMixer.length < 2 || isMixingPrompts}
                        className={`w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 ${selectedPromptsForMixer.length < 2 || isMixingPrompts ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}
                      >
                        {isMixingPrompts ? (
                          <span className="flex items-center justify-center">
                            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Menggabungkan...
                          </span>
                        ) : (
                          `Gabungkan ${selectedPromptsForMixer.length} Prompt Terpilih (AI)`
                        )}
                      </button>
                      {mixError && (
                        <p className="text-red-400 text-sm mt-2 text-center">{mixError}</p>
                      )}
                      {mixedPrompt && (
                         <div className={`mt-6 p-4 rounded-lg shadow-inner border ${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-gray-200 border-gray-300'}`}>
                            <h3 className={`text-lg font-semibold mb-2 ${isDarkMode ? 'text-yellow-300' : 'text-yellow-700'}`}>Prompt Gabungan (AI):</h3>
                            <textarea
                              readOnly
                              rows="5"
                              className={`w-full p-2 rounded-md font-mono text-sm resize-none focus:outline-none ${isDarkMode ? 'bg-gray-900 border-gray-700 text-gray-200' : 'bg-white border-gray-300 text-gray-800'}`}
                              value={mixedPrompt}
                            ></textarea>
                            <button
                              onClick={() => copyToClipboard(mixedPrompt, setMixError)} // Reuse setMixError to display copy message
                              className="mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-1.5 px-3 rounded-md transition-all duration-300 text-xs"
                            >
                              Salin Prompt Gabungan
                            </button>
                        </div>
                      )}
                    </div>
                  )}
                </div>

                {/* Prompt Favorit */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-red-300' : 'text-red-700'}`}>
                    Prompt Favorit ❤️
                  </h2>
                  {favoritePrompts.length === 0 ? (
                    <p className={`text-center ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>Belum ada prompt favorit. Tandai prompt dengan hati!</p>
                  ) : (
                    <div className="space-y-3">
                      {favoritePrompts.map((item, index) => (
                        <div key={index} className={`p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center ${isDarkMode ? 'bg-gray-800' : 'bg-white border border-gray-200'}`}>
                          <p className={`text-sm flex-grow mb-2 sm:mb-0 mr-4 ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                            <span className="font-semibold">{item.timestamp}:</span> {item.prompt.substring(0, 80)}...
                          </p>
                          <div className="flex gap-2">
                            <button
                              onClick={() => loadFavoritePrompt(index)}
                              className="bg-purple-500 hover:bg-purple-600 text-white py-1.5 px-3 rounded-md text-xs"
                            >
                              Muat
                            </button>
                            <button
                              onClick={() => deleteFavoritePrompt(index)}
                              className="bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md text-xs"
                            >
                              Hapus
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>


                {/* Manajemen Multi-Adegan/Penceritaan */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-sky-300' : 'text-sky-700'}`}>
                    Manajemen Adegan Cerita
                  </h2>
                  <p className={`text-center mb-4 ${isDarkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                    Tambahkan prompt yang dihasilkan sebagai adegan untuk membangun cerita panjang.
                  </p>
                  <div className="flex flex-col gap-3">
                    <button
                      onClick={generateCombinedStoryPrompt}
                      className="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-all duration-300 hover:scale-105"
                    >
                      Hasilkan Prompt Cerita Gabungan
                    </button>
                    {scenes.length === 0 ? (
                      <p className={`text-center mt-4 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>Belum ada adegan dalam cerita Anda.</p>
                    ) : (
                      <div className="space-y-3 mt-4">
                        {scenes.map((scene, index) => (
                          <div key={scene.id} className={`p-4 rounded-lg flex flex-col sm:flex-row justify-between items-start sm:items-center ${isDarkMode ? 'bg-gray-800' : 'bg-white border border-gray-200'}`}>
                            <p className={`text-sm flex-grow mb-2 sm:mb-0 mr-4 ${isDarkMode ? 'text-gray-200' : 'text-gray-800'}`}>
                              <span className="font-semibold">Adegan {index + 1}:</span> {scene.prompt.substring(0, 80)}...
                            </p>
                            <div className="flex gap-2">
                              <button
                                onClick={() => loadScene(index)}
                                className="bg-purple-500 hover:bg-purple-600 text-white py-1.5 px-3 rounded-md text-xs"
                              >
                                Muat
                              </button>
                              <button
                                onClick={() => toggleFavorite(scene, 'scene')}
                                className={`py-1.5 px-3 rounded-md text-xs ${scene.isFavorite ? 'bg-red-500 hover:bg-red-600 text-white' : (isDarkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-100' : 'bg-gray-300 hover:bg-gray-400 text-gray-800')}`}
                              >
                                {scene.isFavorite ? '❤️ Fav' : '♡ Fav'}
                              </button>
                              <button
                                onClick={() => deleteScene(index)}
                                className="bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md text-xs"
                              >
                                Hapus
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                {/* Panduan Interaktif & Tips Kontekstual */}
                <div className={`mb-10 p-6 rounded-xl shadow-lg border ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'}`}>
                  <h2 className={`text-xl sm:text-2xl font-bold mb-4 text-center ${isDarkMode ? 'text-lime-300' : 'text-lime-700'}`}>
                    Panduan Menulis Prompt Veo 3
                  </h2>
                  <div className={`space-y-4 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    <p>
                      Menulis prompt yang efektif untuk model teks-ke-video seperti Veo 3 sangat penting untuk mendapatkan hasil yang Anda inginkan. Berikut adalah beberapa tips:
                    </p>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>1. Deskripsi Detail adalah Kunci</h3>
                      <p>
                        Gunakan kata sifat dan kata keterangan yang kuat. Alih-alih "orang berjalan," coba "seorang wanita tua yang bijaksana berjalan perlahan di jalanan berbatu yang diterangi cahaya bulan."
                      </p>
                    </div>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>2. Fokus pada Visual dan Aksi</h3>
                      <p>
                        Veo 3 menciptakan video, jadi deskripsikan apa yang terlihat di layar. Jelaskan gerakan, interaksi, tekstur, dan warna.
                      </p>
                    </div>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>3. Tentukan Gaya Visual</h3>
                      <p>
                        Bagian "Gaya Video" sangat penting. Sebutkan gaya seni yang Anda inginkan (misalnya, "gaya Studio Ghibli", "realistis", "animasi 3D", "lukisan cat air") untuk mengarahkan estetika video.
                      </p>
                    </div>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>4. Kontrol Kamera dan Pencahayaan</h3>
                      <p>
                        Gunakan "Sudut Kamera" dan "Gerakan Kamera" untuk mengontrol komposisi dan dinamika adegan. "Pencahayaan" akan memengaruhi suasana dan *mood* visual.
                      </p>
                    </div>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>5. Gunakan Aspek Rasio yang Sesuai</h3>
                      <p>
                        Pilih aspek rasio yang cocok untuk platform tujuan Anda (misalnya, 16:9 untuk YouTube, 9:16 untuk TikTok/Reels).
                      </p>
                    </div>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>6. Manfaatkan Fitur AI</h3>
                      <p>
                        Gunakan "Unggah Gambar" untuk mendapatkan prompt otomatis atau "Sempurnakan Prompt" untuk memperkaya ide Anda. Fitur "Gabungkan Prompt" bisa menciptakan ide-ide unik dari kombinasi prompt yang ada.
                      </p>
                    </div>

                    <div>
                      <h3 className={`font-bold ${isDarkMode ? 'text-lime-200' : 'text-lime-800'}`}>7. Eksperimen dan Iterasi</h3>
                      <p>
                        Jangan takut untuk bereksperimen! Coba variasi kecil pada prompt Anda dan lihat bagaimana hasilnya. Gunakan riwayat untuk melacak ide-ide Anda.
                      </p>
                    </div>
                  </div>
                </div>

                {/* Watermark */}
                <div className={`mt-10 text-center text-sm opacity-70 ${isDarkMode ? 'text-gray-500' : 'text-gray-600'}`}>
                  Dibuat dengan ❤️ oleh Mas Alfan Pekalongan
                </div>
              </div>
            </div>
          );
        }

        // Render the App component into the root div
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
